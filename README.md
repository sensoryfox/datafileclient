# SensoryDataClient: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∏ –∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

[![CI Status](https://img.shields.io/badge/CI-Passing-brightgreen)](./.github/workflows/ci.yml)
[![Coverage](https://img.shields.io/badge/Coverage-92%25-brightgreen)]()
[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](./LICENSE)

**SensoryDataClient** ‚Äî —ç—Ç–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–π Python-–º–æ–¥—É–ª—å, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π –µ–¥–∏–Ω—ã–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–±—ä–µ–∫—Ç–Ω—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º MinIO –∏ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö PostgreSQL. –û–Ω —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ –Ω–∞–¥–µ–∂–Ω—ã–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–º —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª–∞–º–∏ –∏ –∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏, –Ω–æ –∏ –∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫.

## üéØ –ú–∏—Å—Å–∏—è

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º production-ready –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç –≤—Å—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–µ–¥–ª–∞–≥–∞—è –ø—Ä–æ—Å—Ç–æ–π, —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–∫ —Ü–µ–ª—ã–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏, —Ç–∞–∫ –∏ –∏—Ö —Å–æ—Å—Ç–∞–≤–Ω—ã–º–∏ —á–∞—Å—Ç—è–º–∏.

## ‚ú® –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

*   **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å "–∏–∑ –∫–æ—Ä–æ–±–∫–∏"**: –ü–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `asyncio`, `SQLAlchemy 2.0 (async)`, `asyncpg` –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–±–µ—Ä—Ç–∫–∞—Ö –Ω–∞–¥ SDK MinIO.
*   **–ï–¥–∏–Ω—ã–π —Ñ–∞—Å–∞–¥ (`DataClient`)**: –û–¥–∏–Ω –∫–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞–º–∏, –∏—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å—Ç—Ä–æ–∫–∞–º–∏. –ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ –∂–æ–Ω–≥–ª–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ.
*   **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∞–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (`Document Lines`)**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω—è—Ç—å, –æ–±–Ω–æ–≤–ª—è—Ç—å –∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —Ä–∞–∑–æ–±—Ä–∞–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (—Ç–µ–∫—Å—Ç, –∫–æ–¥, —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è) —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ç–∏–ø–∞ –∏ —Ç–æ—á–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ (`float`), —á—Ç–æ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ diff-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏ RAG-–ø–∞–π–ø–ª–∞–π–Ω–æ–≤.
*   **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**: –ú–µ—Ç–æ–¥ `upload_file` –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ—è–≤—è—Ç—Å—è –≤ –ë–î –±–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ–∞–π–ª–∞ –≤ MinIO (—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ—Ç–∫–∞—Ç–æ–º). –û–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏ —Ç–∞–∫–∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã.
*   **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ê–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `Pydantic` –¥–ª—è –º–æ–¥–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö –∏ 100% –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ —Ç–∞–π–ø-—Ö–∏–Ω—Ç–∞–º–∏.
*   **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é**: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ JSON-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É–¥–æ–±–Ω—ã–π CLI-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ –±–∞–∑–µ `Typer`.
*   **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞**: –ì–æ—Ç–æ–≤–æ–µ Docker Compose –æ–∫—Ä—É–∂–µ–Ω–∏–µ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ CLI –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ö–ª–∏–µ–Ω—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω **–§–∞—Å–∞–¥**, —Å–∫—Ä—ã–≤–∞—è –¥–µ—Ç–∞–ª–∏ —Ä–∞–±–æ—Ç—ã —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏, —Ä–∞–±–æ—Ç–∞ —Å PostgreSQL —Ç–µ–ø–µ—Ä—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ –¥–≤–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (SRP).
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –í–∞—à –°–µ—Ä–≤–∏—Å (Business Logic)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         DataClient             ‚îÇ  <- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ                   ‚îÇ                ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  MinIO    ‚îÇ       ‚îÇ MetaData   ‚îÇ   ‚îÇ Line       ‚îÇ
‚îÇ Repository‚îÇ       ‚îÇ Repository ‚îÇ   ‚îÇ Repository ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
 (MinIO SDK)         (SQLAlchemy)     (SQLAlchemy)

```

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –≤ –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –µ–≥–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–∑ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–®–∞–≥ 1: –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
```bash
git clone https://github.com/sensoryfox/datafileclient.git
cd datafileclient
```
**–®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞ –∏ –¥–ª—è –µ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Ç–µ—Å—Ç—ã, –ª–∏–Ω—Ç–µ—Ä—ã).

```bash
pip install -e ".[dev]"
```

## üê≥ –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å Docker

–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –≤–∞–º –ø–æ–Ω–∞–¥–æ–±—è—Ç—Å—è –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã PostgreSQL –∏ MinIO. –ú—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º –≥–æ—Ç–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `docker-compose`.

**–®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä. –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –º–µ–Ω—è—Ç—å –Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ.

```bash
cp .env.example .env
```

> **–í–∞–∂–Ω–æ:** –§–∞–π–ª `.env` –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å `POSTGRES_HOST=localhost` –∏ `MINIO_ENDPOINT=localhost:9000` –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å –≤–∞—à–µ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º.

**–®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ**
–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –ø–æ–¥–Ω–∏–º–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å PostgreSQL –∏ MinIO.

```bash
docker-compose up -d
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:
*   **–í–µ–±-–∫–æ–Ω—Å–æ–ª—å MinIO** –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:9001`.
*   **PostgreSQL** –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É `localhost:5432`.

**–®–∞–≥ 3: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ**
–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—ã –≤ PostgreSQL (`documents`, `document_lines`) –∏ –±–∞–∫–µ—Ç –≤ MinIO.
```bash
python -m sensory_data_client init
```
**–®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π Python-–∫–æ–¥ –º–æ–∂–µ—Ç –¥–æ—Å—Ç—É—á–∞—Ç—å—Å—è –¥–æ —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ Docker.
```bash
python -m sensory_data_client check
```
–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

```bash
‚úÖ Connection Check
‚úî PostgreSQL connection: OK
‚úî MinIO connection: OK (bucket: 'test-bucket')
```
## üõ†Ô∏è –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```py
import asyncio
from uuid import uuid4
from sensory_data_client import create_data_client, DocumentCreate, DocumentMetadata, Line

# --- 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ —Ñ–∞–±—Ä–∏–∫—É ---
client = create_data_client()

# --- 2. –ú–æ–¥–µ–ª—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö ---
doc_meta = DocumentCreate(
    user_document_id="ext-id-456",
    name="Project Proposal.md",
    owner="user-02",
    access_group="engineering",
    extension="md"
)

# --- 3. –ö–æ–Ω—Ç–µ–Ω—Ç —Ñ–∞–π–ª–∞ ---
file_content = b"# Project Sensory\n\nThis is the main proposal document."

# --- 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ —Ñ–∞–π–ª–∞ ---
document_lines = [
    Line(block_id="block-1", position=1.0, type="header", content="# Project Sensory"),
    Line(block_id="block-2", position=2.0, type="paragraph", content="This is the main proposal document."),
]


async def main():
    """–û—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞."""
    new_doc_id = None
    try:
        # --- 5. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö ---
        print("Uploading file...")
        new_doc = await client.upload_file(
            file_name="proposal.md",
            content=file_content,
            meta=doc_meta
        )
        new_doc_id = new_doc.id
        print(f"Document created with ID: {new_doc_id}")

        # --- 6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–∑–æ–±—Ä–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞ ---
        print("\nSaving document lines...")
        await client.save_document_lines(new_doc_id, document_lines)
        print(f"Saved {len(document_lines)} lines.")

        # --- 7. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏–∑ –ë–î ---
        print("\nFetching document lines...")
        retrieved_lines = await client.list_doclines(new_doc_id)
        assert len(retrieved_lines) == len(document_lines)
        assert retrieved_lines[0].content == "# Project Sensory"
        print("Lines match!")

        # --- 8. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ ---
        print("\nGenerating presigned URL for the original file...")
        download_url = await client.generate_download_url(new_doc_id, expires_in=60)
        print(f"URL (expires in 60s): {download_url}")

    except Exception as e:
        print(f"An error occurred: {e}")

    finally:
        # --- 9. –£–¥–∞–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ ---
        if new_doc_id:
            print(f"\nDeleting document {new_doc_id}...")
            # –£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ —Ñ–∞–π–ª–∞. –°—Ç—Ä–æ–∫–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –∫–∞—Å–∫–∞–¥–Ω–æ –∏–ª–∏ –∏—Ö –Ω—É–∂–Ω–æ —É–¥–∞–ª—è—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ.
            await client.delete_file(new_doc_id)
            print("Document deleted successfully.")

if __name__ == "__main__":
    asyncio.run(main())
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ö–ª–∏–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ —Ñ–∞–π–ª–µ `.env.example`.
| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| ------------------ | ----------------------------------------- | --------------------- |
| `POSTGRES_HOST` | –•–æ—Å—Ç PostgreSQL | `localhost` |
| `POSTGRES_PORT` | –ü–æ—Ä—Ç PostgreSQL | `5432` |
| `POSTGRES_DB` | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | `documents` |
| `POSTGRES_USER` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å PostgreSQL | `postgres` |
| `POSTGRES_PASSWORD` | –ü–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è PostgreSQL | `postgres` |
| `MINIO_ENDPOINT` | –ê–¥—Ä–µ—Å MinIO (—Ö–æ—Å—Ç:–ø–æ—Ä—Ç) | `localhost:9000` |
| `MINIO_ACCESS_KEY` | –ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞ MinIO | `minioadmin` |
| `MINIO_SECRET_KEY` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á MinIO | `minioadmin` |
| `MINIO_BUCKET` | –ò–º—è –±–∞–∫–µ—Ç–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ | `documents` |
| `MINIO_SECURE` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TLS –¥–ª—è MinIO (`True`/`False`) | `False` |
| `LOG_LEVEL` | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (`INFO`, `DEBUG`, ...) | `INFO` |
## ‚å®Ô∏è Command-Line Interface (CLI)

–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤ –∫–ª–∏–µ–Ω—Ç –≤—Å—Ç—Ä–æ–µ–Ω CLI –Ω–∞ –±–∞–∑–µ `Typer`. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –º–æ–¥—É–ª—å.

*   **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã:**
   –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î –∏ –±–∞–∫–µ—Ç –≤ MinIO.
   
```bash
python -m sensory_data_client init
```
*   **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:**
   –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å PostgreSQL –∏ MinIO —Å —Ç–µ–∫—É—â–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.

```bash
python -m sensory_data_client check
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `testcontainers` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ PostgreSQL –∏ MinIO.

–î–ª—è –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `pytest`:

```bash
pytest
```
–¢–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–Ω–∏–º—É—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã, –≤—ã–ø–æ–ª–Ω—è—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –æ—Å—Ç–∞–Ω–æ–≤—è—Ç –∏—Ö –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.
